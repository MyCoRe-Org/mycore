<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- ============================================== -->
<!--      MyCoRe-WebService build file for use with ANT        -->
<!-- $Revision: 1.2 $ $Date: 2005-12-20 13:15:04 $ -->
<!-- ============================================== -->

<project name="MyCoReModule - WebService" default="usage" basedir=".">

    <property name="hostname"      value="localhost" />
    <property name="port"          value="8080" />
    <property name="servletpath"   value="/docportal/services/AdminService" />
    <property name="webservice"    value="/docportal/services/MCRWebService" />

	<!-- ============================================== -->

	<property name="build.sysclasspath" value="last" />

	<!-- ============================================== -->

	<target name="version">
		<echo>
           Ant version: ${ant.version}
      Java JDK version: ${java.version} 
      Operating system: ${os.name}, version: ${os.version}, architecture: ${os.arch}
    </echo>
	</target>

	<!-- ============================================== -->

	<target name="usage">
		<echo>
      Use the ant tool to plug in MyCoRe-WeService-Module:
      Usage: ant [target] [target] [target] ...

      Available targets for MyCoRe-WebService are:
        compile                         compiles the Java Sources
        webapps                         copy files to webapps
        deploy                          deploy webservices
        undeploy                        undeploy webservices
        wsdl2java                       generate stub from wsdl
        compile.client                  compile webservice client
        wsclient.cmd                    build wsclient command
        clean                           delete directory build
		</echo>
	</target>
	
  <!-- =================================================================== -->
  <!-- Compiles the sources from directory sources to directory classes    -->
  <!-- =================================================================== -->

  <target name="init">
    <mkdir dir="${basedir}/classes" />
    <path id="mycore.classpath">
      <fileset dir="${basedir}/lib" includes="*.jar"/>
      <fileset dir="${basedir}/modules/module-webservices/lib" includes="*.jar"/>
    </path>
  </target>

  <target name="javac" depends="init" >
    <echo>Compiling ${packages}</echo>
    <javac srcdir="${basedir}/modules/module-webservices/sources"
           destdir="${basedir}/classes"
           includes="${packages}"
           excludes="org/mycore/services/wsclient/**"
           classpathref="mycore.classpath"
           debug="${debug}"
           optimize="${optimize}"
           target="${javatarget}"
           source="${sourcerelease}"
           encoding="${sourceencoding}"
           deprecation="${deprecation}">
    </javac>
  </target>

  <target name="compile">
   <echo>Compiling Module MyCoRe-WebServices classes...</echo>
   <antcall target="javac">
     <param name="packages" value="org/**"/>
   </antcall>
  </target>

  <!-- =================================================================== -->
  <target name="webapps">
    <echo>
      Copying web application files of module "WebServices"
    </echo>
    <copy todir="webapps/WEB-INF/lib">
      <fileset dir="${env.MYCORE_HOME}/modules/module-webservices/lib" includes="*.jar" />
    </copy>
  </target>

  <!-- ============================================== -->

  <target name="deploy" description="deploys all webservices to a running axis admin servlet">
    <antcall target="axis.admin">
      <param name="wsdd" value="deploy" />
    </antcall>
  </target>

  <!-- ============================================== -->
	
  <target name="undeploy" description="undeploys all webservices from a running axis admin servlet">
    <antcall target="axis.admin">
      <param name="wsdd" value="undeploy" />
    </antcall>
  </target>

  <!-- ============================================== -->
		
  <target name="axis.admin">
    <path id="deploy.classpath">
      <fileset dir="../../lib" includes="*.jar" />
      <fileset dir="lib" includes="*.jar" />
    </path>
    <taskdef resource="axis-tasks.properties" classpathref="deploy.classpath" />
    <axis-admin 
      port="${port}" 
      hostname="${hostname}" 
      failonerror="true" 
      servletpath="${servletpath}" 
      debug="true" 
      xmlfile="conf/${wsdd}.wsdd" 
    />
  </target>

  <!-- ============================================== -->

  <target name="wsdl2java">
    <path id="wsdl2java.classpath">
      <fileset dir="../../lib" includes="*.jar" />
      <fileset dir="lib" includes="*.jar"/>
    </path>
    <taskdef name="axis-wsdl2java" classname="org.apache.axis.tools.ant.wsdl.Wsdl2javaAntTask" classpathref="wsdl2java.classpath" />
    <delete dir="build/src" />
    <mkdir dir="build/src" />
    <axis-wsdl2java 
      all="true"
      output="build/src"
      testcase="false"
      verbose="true"
      serverside="true"
      url="http://${hostname}:${port}${webservice}?wsdl" 
    >
      <mapping namespace="http://${hostname}:${port}${webservice}" package="org.mycore.services.wsclient" /> 
    </axis-wsdl2java>
  </target>

  <!-- ============================================== -->

  <target name="compile.client" depends="wsdl2java">
    <echo>
      Compiling WebServices client
    </echo>
    <mkdir dir="build/classes" />
    <path id="axis.classpath">
      <fileset dir="../../lib" includes="*.jar" />
      <fileset dir="lib" includes="*.jar"/>
    </path>
    <javac srcdir="sources" includes="org/mycore/services/wsclient/**" destdir="build/classes" classpathref="axis.classpath" encoding="ISO-8859-1">
      <src path="sources" />
      <src path="build/src" />
    </javac>
  </target>
  
  <!-- ============================================== -->

    <target name="wsclient.cmd" depends="compile.client">
    <echo>

      Generating wsclient.cmd for starting wsclient from Command Line
    </echo>
    
    <mkdir dir="build/bin" />

    <echo file="build/bin/mycore.properties"/>
    
    <path id="wsclient.classpath">
      <fileset dir="../../lib" includes="*.jar" />
      <fileset dir="lib" includes="*.jar"/>
      <pathelement location="build/classes" />
    </path>
    
   <property name="path"           refid="wsclient.classpath"/>

    <echo file="build/bin/wsclient.cmd">@echo off 
SET AXISCLASSPATH=${path};%CLASSPATH% 
java -Xms128m -Xmx512m -classpath "%AXISCLASSPATH%" org.mycore.services.wsclient.MCRWebServiceClient %1 %2 %3 %4 %5 %6 %7 %8 %9
    </echo>
  </target>
  
  <!-- ============================================== -->

    <target name="clean">
    <echo>
      Delete directory "build"
    </echo>
    
    <delete dir="build" />
  </target>
  
</project>


