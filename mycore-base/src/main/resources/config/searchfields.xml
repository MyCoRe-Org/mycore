<?xml version="1.0" encoding="UTF-8"?>

<searchfields xmlns="http://www.mycore.org/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mycore.org/ searchfields.xsd"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:mods="http://www.loc.gov/mods/v3">

  <!-- Search in MCRObject metadata -->
  <index id="metadata">

    <!-- Search in service/structural metadata -->
    <field name="id" type="identifier" source="objectMetadata" xpath="/mycoreobject" value="@ID" />
    <field name="objectProject" type="identifier" source="objectMetadata" xpath="/mycoreobject" value="substring-before(@ID,'_')" />
    <field name="objectType" type="identifier" source="objectMetadata" xpath="/mycoreobject" value="substring-before(substring-after(@ID,'_'),'_')" />
    <field name="link" type="identifier" source="objectMetadata" xpath="/mycoreobject/descendant::*[@xlink:href]" value="@xlink:href" />
    <field name="parent" type="identifier" source="objectMetadata" xpath="/mycoreobject/structure/parents/parent" value="@xlink:href" />
    <field name="modified" type="timestamp" source="objectMetadata" xpath="/mycoreobject/service/servdates/servdate[@type='modifydate']"
      value="." sortable="true" i18n="editor.search.document.datemod" />
    <field name="created" type="timestamp" source="objectMetadata" xpath="/mycoreobject/service/servdates/servdate[@type='createdate']"
      value="." sortable="true" />

    <!-- Search in xml of the derivate objects -->
    <field name="derivateModificationDate" type="date" source="derivateMetadata" xpath="/mycorederivate/service/servdates/servdate[@type='modifydate']"
      value="substring(., 1, 10)" sortable="true" />
    <field name="derivateCreationDate" type="timestamp" source="derivateMetadata" xpath="/mycorederivate/service/servdates/servdate[@type='createdate']"
      value="." sortable="true" />

    <field name="derivateURN" type="identifier" source="derivateMetadata"
      xpath="/mycorederivate/derivate/fileset/file/urn | /mycorederivate/derivate/fileset/@urn" value="." />
    <field name="derivateOwner" type="identifier" source="derivateMetadata" xpath="/mycorederivate/derivate/linkmetas/linkmeta" value="@xlink:href"
      addable="true" />

    <field name="category" type="identifier" source="objectCategory">
      <xsl:for-each select="/mycoreobject/descendant::*[@classid and @categid]">
        <xsl:variable name="classid" select="@classid" />
        <xsl:variable name="uri" select="concat('classification:metadata:0:parents:',@classid,':',@categid)" />
        <xsl:for-each select="document($uri)//category">
          <mcr:category xmlns:mcr="http://www.mycore.org/">
            <xsl:value-of select="concat($classid,':',@ID)" />
          </mcr:category>
        </xsl:for-each>
      </xsl:for-each>
      <xsl:for-each select="/mycoreobject/metadata//mods:*[@authority or @authorityURI]">
        <xsl:variable name="uri" xmlns:mcrmods="xalan://org.mycore.mods.MCRMODSClassificationSupport" select="mcrmods:getClassCategParentLink(.)" />
        <xsl:if test="string-length($uri) &gt; 0">
          <xsl:variable name="classdoc" select="document($uri)"/>
          <xsl:for-each select="$classdoc//category">
            <mcr:category xmlns:mcr="http://www.mycore.org/">
              <xsl:value-of select="concat($classdoc/mycoreclass/@ID,':',@ID)" />
            </mcr:category>
          </xsl:for-each>
        </xsl:if>
      </xsl:for-each>
    </field>

    <!-- Search in all metadata fields (that have an xml:lang attribute) -->
    <field name="allMeta" source="objectMetadata" type="text" i18n="editor.search.metadata">
      <mcr:allMeta xmlns:mcr="http://www.mycore.org/">

        <xsl:for-each select="/mycoreobject/metadata/*//*">
          <xsl:value-of select="text()|@xlink:title" />
          <xsl:text>          </xsl:text>
        </xsl:for-each>

        <xsl:for-each select="/mycoreobject/metadata/*/*[@classid and @categid]">
          <xsl:variable name="uri" select="concat('classification:metadata:0:parents:',@classid,':',@categid)" />

          <xsl:for-each select="document($uri)//category/label">
            <xsl:value-of select="@text" />
            <xsl:text>          </xsl:text>
          </xsl:for-each>
        </xsl:for-each>

      </mcr:allMeta>
    </field>

    <!-- Field for sorting by score -->
    <field name="score" type="decimal" source="searcherHitMetadata" sortable="true" />
  </index>

  <!-- Search in MCRFile metadata and content -->
  <index id="content">
    <field name="metsLogicalDivLabels" type="text" source="fileXMLContent" objects="xml" xpath="/mets:mets/mets:structMap[@TYPE='LOGICAL']/descendant-or-self::*" value="@LABEL"></field>

    <!-- Search in fulltext of pdf and txt files -->
    <field name="content" type="text" source="fileTextContent" objects="html pdf ps txt xml msword95 msword97 msppt rtf odt sxw" i18n="editor.search.fulltext" />

    <!-- Search in technical metadata of files -->
    <field name="fileID" type="identifier" source="fileMetadata" xpath="file/@id" value="." />
    <field name="DerivateID" type="identifier" source="fileMetadata" xpath="file/@owner" value="." addable="true" />
    <field name="fileName" type="identifier" source="fileMetadata" xpath="file/@name" value="." addable="true" />
    <field name="filePath" type="identifier" source="fileMetadata" xpath="file/@path" value="." addable="true" />
    <field name="fileSize" type="integer" source="fileMetadata" xpath="file/@size" value="." />
    <field name="fileExtension" type="identifier" source="fileMetadata" xpath="file/@extension" value="." />
    <field name="fileContentTypeID" type="identifier" source="fileMetadata" xpath="file/contentTypeID" value="." />
    <field name="fileContentType" type="text" source="fileMetadata" xpath="file/@contentType" value="." />
    <field name="fileDateModified" type="date" source="fileMetadata" xpath="file/@modified" value="ext:normalizeDate(string(.))" />

    <!-- Search in technical metadata of audio/video files -->
    <field name="avBitRate" type="integer" source="fileMetadata" xpath="file/@bitRate" value="." />
    <field name="avFrameRate" type="decimal" source="fileMetadata" xpath="file/@frameRate" value="." />
    <field name="avDuration" type="time" source="fileMetadata" xpath="file/@duration" value="." />
    <field name="avMediaType" type="identifier" source="fileMetadata" xpath="file/@mediaType" value="." />
    <field name="fileURN" type="identifier" source="fileMetadata" xpath="file/@urn" value="." />
    <field name="fileCategory" type="identifier" source="fileMetadata">
      <xsl:for-each select="file/category">
        <xsl:variable name="uri" select="concat('classification:metadata:0:parents:',@id)" />
        <xsl:for-each select="document($uri)//category">
          <mcr:fileCategory xmlns:mcr="http://www.mycore.org/">
            <xsl:value-of select="concat(/mycoreclass/@ID,':',@ID)" />
          </mcr:fileCategory>
        </xsl:for-each>
      </xsl:for-each>
    </field>
  </index>

  <index id="urn">
    <!-- field for retrieving all objects where the derivates have urn -->
    <field name="objectsWithURN" source="objectMetadata" type="boolean" />
    <field name="objectURN" source="objectMetadata" type="text" />
  </index>
</searchfields>
